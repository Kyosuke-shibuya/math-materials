<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Learning Center | Kyosuke Shibuya</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500&family=Noto+Serif+JP:wght@400;600&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Noto Sans JP"', 'sans-serif'], serif: ['"Noto Serif JP"', 'serif'] },
                    animation: { 'fade-in': 'fadeIn 0.5s ease-in-out' },
                    keyframes: { fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } } }
                }
            }
        }
    </script>
    <style>
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary ~ * { animation: sweep .3s ease-in-out; }
        @keyframes sweep {
            0%    { opacity: 0; transform: translateY(-10px); }
            100%  { opacity: 1; transform: translateY(0); }
        }
        details[open] summary .arrow-icon { transform: rotate(180deg); }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans min-h-screen flex flex-col">

    <header class="fixed top-0 w-full h-16 bg-gray-950/90 backdrop-blur-md border-b border-gray-800 flex items-center justify-between px-6 z-40">
        <div class="flex items-center gap-4">
            <a href="index.html" class="text-xl text-gray-400 hover:text-white transition">
                <i class="fa-solid fa-arrow-left"></i>
            </a>
            <h1 class="font-serif text-lg tracking-wider text-yellow-500">Audio Center</h1>
        </div>
        <div class="text-gray-600 text-sm"><i class="fa-solid fa-headphones-simple"></i></div>
    </header>

    <main class="flex-grow pt-24 pb-20 px-4 max-w-4xl mx-auto w-full animate-fade-in">
        
        <div class="text-center mb-10">
            <h2 class="text-2xl font-serif font-bold text-white mb-2">Listening Library</h2>
            <p class="text-xs text-gray-500 tracking-[0.3em] uppercase">思考のプロセスを耳でインストールする</p>
        </div>

        <div id="audio-container" class="flex flex-col gap-4">
            <p class="text-center text-gray-500 animate-pulse mt-10">Loading tracks...</p>
        </div>

    </main>

    <script>
        // 設定: prefixは音声ファイル名の接頭辞
        const units = [
            { id: "math1_quadra", title: "数学 I：二次関数", icon: "fa-bezier-curve", prefix: "quadra", link: "math1_quadra.html" },
            { id: "matha_prob", title: "数学 A：場合の数と確率", icon: "fa-dice", prefix: "prob", link: "matha_prob.html" },
            { id: "math2_equation_comp", title: "数学 II：式と証明・複素数", icon: "fa-scale-balanced", prefix: "equation", link: "math2_equation_comp.html" },
            { id: "math2_calculus", title: "数学 II：微分積分", icon: "fa-chart-area", prefix: "calculus", link: "math2_calculus.html" },
            { id: "mathb_sequence", title: "数学 B：数列", icon: "fa-arrow-down-1-9", prefix: "sequence", link: "mathb_sequence.html" },
            { id: "mathc_vector", title: "数学 C：平面ベクトル", icon: "fa-location-arrow", prefix: "vector", link: "mathc_vector.html" },
            { id: "mathc_vector3d", title: "数学 C：空間ベクトル", icon: "fa-cube", prefix: "vector3d", link: "mathc_vector3d.html" }
        ];

        const container = document.getElementById('audio-container');

        // メイン処理: 各HTMLファイルを読み込んでデータを抽出
        async function loadAllUnits() {
            container.innerHTML = ''; // Loading表示を消去

            for (const unit of units) {
                let itemsHTML = '';
                let itemCount = 0;

                try {
                    // 1. 各単元のHTMLファイルをフェッチ
                    const response = await fetch(unit.link);
                    const text = await response.text();

                    // 2. 正規表現で const unitData = [...] の中身を抽出
                    const match = text.match(/const\s+unitData\s*=\s*(\[[\s\S]*?\]);/);

                    if (match && match[1]) {
                        // 3. 文字列をJSオブジェクトとして評価
                        // (new Functionを使うことで、キーにクォートがなくてもパース可能にします)
                        const unitData = new Function('return ' + match[1])();
                        itemCount = unitData.length;

                        // 4. 音声リストHTMLを生成
                        itemsHTML = unitData.map(item => `
                            <div class="bg-gray-800 rounded p-4 border border-gray-700 hover:border-yellow-600 transition group flex flex-col justify-between h-full">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <span class="text-[10px] text-yellow-600 font-bold tracking-widest block mb-1">NO.${item.id}</span>
                                        <h4 class="text-xs font-medium text-gray-200 group-hover:text-white transition leading-relaxed">${item.title || item.t}</h4> 
                                    </div>
                                    <a href="${unit.link}" class="text-gray-600 hover:text-white text-xs p-1"><i class="fa-solid fa-arrow-up-right-from-square"></i></a>
                                </div>
                                <div class="bg-gray-900 rounded-full px-3 py-1 flex items-center gap-2 border border-gray-800 mt-auto">
                                    <i class="fa-solid fa-play text-gray-500 text-[10px]"></i>
                                    <audio controls preload="none" class="w-full h-6 opacity-80 filter invert" src="audio/${unit.prefix}_${item.id}.m4a"></audio>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        throw new Error("Data not found");
                    }

                } catch (e) {
                    console.error(`Failed to load ${unit.title}`, e);
                    itemsHTML = `<p class="col-span-full text-xs text-gray-500 italic p-4">データの読み込みに失敗しました。<br>(${unit.link} 内に unitData が存在するか確認してください)</p>`;
                }

                // 5. アコーディオン枠を生成して追加
                const detailsHTML = `
                    <details class="group bg-gray-900 border border-gray-800 rounded-lg overflow-hidden shadow-sm open:bg-gray-800/50 open:border-gray-700 transition-colors duration-300">
                        <summary class="flex items-center justify-between p-5 cursor-pointer select-none hover:bg-gray-800 transition">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-yellow-600 group-open:bg-yellow-500 group-open:text-gray-900 transition-colors">
                                    <i class="fa-solid ${unit.icon} text-lg"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-200 text-base tracking-wider group-open:text-white">${unit.title}</h3>
                                    <p class="text-xs text-gray-500 group-open:text-gray-400">Total ${itemCount} Tracks</p>
                                </div>
                            </div>
                            <i class="fa-solid fa-chevron-down text-gray-600 arrow-icon transition-transform duration-300"></i>
                        </summary>
                        <div class="p-5 pt-0 border-t border-gray-700/50 mt-2">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
                                ${itemsHTML}
                            </div>
                        </div>
                    </details>
                `;
                container.insertAdjacentHTML('beforeend', detailsHTML);
            }
        }

        // 実行
        loadAllUnits();
    </script>
</body>
</html>